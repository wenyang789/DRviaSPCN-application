# Preparation ----
getwd()
setwd("/Users/wendy_1/DRviaSPCN-application/DEG-analysis")
# Preparation ----
getwd()
setwd("/Users/wendy_1/DRviaSPCN-application/DEG-analysis")
# Set parameters
options(stringsAsFactors = F)
rm(list=ls())  # Clear the variables
job <- "UCEC"  # Set "UCEC" as an example
# Load libraries
library(limma)
library(ggplot2)
library(ggVolcano)
# Read the TPM raw expression data with row × col = gene × samples
expr_data <- read.csv("UCEC_HiSeqV2.csv",
header = TRUE, sep = "",
stringsAsFactors = FALSE,
check.names = FALSE)
# Delete genes that have no expression
expr_data <- expr_data[which(rowSums(expr_data)!=0),]
# Perform log2 transformation and replace negative infinity values with 0
expr_data = log2(expr_data)
expr_data[expr_data == -Inf] = 0
head(expr_data)
# Read group labels of samples
group<-read.csv("UCEC_experiment.csv",
header = T, sep = "")
head(group)
# Constructing grouping matrix (design matrix) ----
design <- model.matrix(~0+factor(group$experiment))  # The design matrix is composed of 0 & 1 and is a diagonal matrix.
head(design)
colnames(design) <- levels(factor(group$experiment))
head(design)
rownames(design) <- colnames(expr_data)
head(design)
# Set the sample comparison method
contrast.matrix <- makeContrasts(Cancer - Normal, levels = design)  # The contrast matrix is a matrix composed of 1 & -1.
contrast.matrix
# Perform nonlinear least squares analysis
fit <- lmFit(expr_data,design)
fit2 <- contrasts.fit(fit, contrast.matrix)
# Use empirical Bayes to adjust the variance part in the t-test to obtain the differential expression results
fit2 <- eBayes(fit2)
# DEG results ----
DEG <- topTable(fit2, coef = 1,n = Inf,sort.by="logFC")
DEG <- na.omit(DEG)
write.csv(DEG, paste0(job,"_","allGene.csv"))
# 最终生成的DEG文件包含以下几列信息：
# 最终生成的DEG文件包含以下几列信息：
# > colnames(DEG)
# 最终生成的DEG文件包含以下几列信息：
# > colnames(DEG)
# [1] "logFC"     "AveExpr"   "t"         "P.Value"   "adj.P.Val" "B"
# 最终生成的DEG文件包含以下几列信息：
# > colnames(DEG)
# [1] "logFC"     "AveExpr"   "t"         "P.Value"   "adj.P.Val" "B"
# [7] "regulate"  "Genes"
colnames(DEG)
colnames(DEG)
